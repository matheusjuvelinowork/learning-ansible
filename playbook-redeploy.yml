---
- name: redeploy k8s
  hosts: localhost
  connection: local
  gather_facts: false


  tasks:
    - name: Executar redeploy
      block:
        - name: Para deployment
          shell: 'curl -v -XPATCH  -H "Accept: application/json, */*" -H "Content-Type: application/strategic-merge-patch+json" -H "User-Agent: kubectl/v1.22.3 (linux/amd64) kubernetes/c920368" "https://127.0.0.1:55093/apis/apps/v1/namespaces/default/deployments/nginx-deployment?fieldManager=kubectl-rollout"'
          register: result
        - debug:
            var: result
        - set_fact: 
            add_info: "AWX:DATA:SUCCESS= Execução de redeploy com sucesso."
        - debug:
            msg: 
              - "{{ add_info }}"
        - set_fact:
            state: 'true'    
      rescue:
        - set_fact:
            msg_result: "AWX:ERROR:MSG= Execução de redeploy com erro"
        - fail:
            msg: "{{ msg_result }}"
            
        - set_fact:
            state: 'false'
